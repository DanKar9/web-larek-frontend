# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды


```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении 

Товар

```
 interface IProduct {
   id: string,
   description : string,
   image : string,
   title: string,
   category: string,
   price: number| null
}
```

Покупатель

```
  interface IUser {
   payment: string,
   email: string,
   phone: string,
   address: string,
   total: number | null,
   items: string[]
}

```

Интерфейс для модели данных продуктов

```
  interface IProductsData {
   products: IProduct[];
   preview: string | null
}
```




Данные карточки, используемые в корзине при создании новой карточки
```javasc
 type TCardBascet = Pick<IProduct, 'title' | 'price' >
```

Данные карточки, используемые в  оформлении товара

```
   type TUserInfoContacts = Pick<IUser, 'payment' | 'address' |'email' | 'phone'>
```



## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component
Представляет собой абстрактный класс, на основе которого базируются все остальные компоненты интерфейса. Он предоставляет общие методы для управления DOM-элементами, такие как переключение классов, установка текстового содержимого компонента или его изображения, управление видимостью и другие,

### Слой данных

#### Класс ProductData
Класс отвечает за хранение данных товара и логику работы с ними.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _product: IProduct[] - массив объектов продуктов
- _preview: string | null - id продукта, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- getProducts():IProduct[] - возвращает массив товаров
- getProduct(id:string) : IProduct - возваращет товар по id
- setProduct(product: IProduct[]): void - метод для заполнение массива товаров
- savePreview(product:IProduct): void; - метод для сохранения товара в Preview
- saveProduct(product:IProduct):void - метод для сохрание товара

Классы представления
Представление управляет отображением данных и обработкой событий пользовательского интерфейса, таких как клики на карточки товаров и кнопки.

#### Класс UserData

Класс отвечает за хранение и логику работы с данными текущего пользователя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
  - payment: string - выбор оплаты
  - email: string - почта покупателя
  - phone: string - номер телефона покупателя
  - address: string адрес покупателя
  - total: number | null - сумма корзины
  - items: TUserInfoContacts[] - корзина товаров
  - events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

  Так же класс предоставляет набор методов для взаимодействия с этими данными.

   - addProductBasket(product:IProduct):void - добавляет товар в корзину
   - deleteProduct(productId:string):void - удаление товара из корзины
   - deleteBasket(product:TCardBascet):void - очистка корзины
   - checkValidation(data: Record<keyof TUserInfoContacts,string>) :boolean - проверяет объект с данными пользователя на валидность


 ####  Класс Modal
Реализует модальное окно. Предоставляет методы open, close, render для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку крестик для закрытия модального окна. Конструктор принимает два аргумента:

- container - корневой элемент модального окна в DOM, переданный в качестве HTMLElement.
- events - объект, реализующий интерфейс IEvents Поля класса:
- _closeButton: HTMLButtonElement - кнопка для закрытия модального окна
- _content - контейнер для содержимого модального окна
- events - брокер событий


#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные категории, заголовка, изображения, цены и описания. Класс наследуется от родительского класса Component и используется для отображения карточек на странице сайта. Поля класса содержат элементы разметки элементов карточки Методы:

- setData(productData: IProduct) - заполняет атрибуты элементов товаров данными
- а также геттеры и сеттеры для свойств, отвечающих за данные товаров
#### Класс Catalog
Отвечает за отображение каталога с товарами на главной странице. Метод :
- addProduct(productElement: HTMLElement) - для добавления товара на страницу

### Слой коммуникации
#### Класс WebApi
Данный класс принимает в конструктор экземпляр класс Api и предоставляет методы реализующие взаимодействие с backend-частью приложения

### Взаимодействие компонентов
Код, описывающий взаимодействие слоя представления и слоя данных между собой и фактически выполняющий роль презентера, находится в файле index.ts Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в index.ts В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

Список всех событий, которые могут генерироваться в системе:
События изменения данных (генерируются классами моделей данных)

- products:changed - изменение массива товаров
- product:selected - должна провоцировать открытие модального окна товара
- preview:changed - изменение товара в модальном окне
- modal:open - открытие модального окна
- modal:close - закрытие модального окна
- basket:open - открываем интерфейс корзины
- basket:close - закрываем интерфейс корзины
- basket:changed - смена числа на счетчике товаров корзины, расположенной на главной странице, изменение суммы приобретенных товаров, изменение корзины
- order:open - открываем окно оформления заказа с первой формой
- order:changed - изменяем поля формы оформления заказа
- order:submit - переход на заполнение данных пользователя
- order:validation - событие, сообщающее о необходимости валидации формы оформления заказа
- contacts:changed - изменяем поля формы заполнения данных клиента
- contacts:submit - отправка post-запроса на сервер, открытие окна, уведомляющего об успешном оформлении заказа, а также очистка разметки корзины